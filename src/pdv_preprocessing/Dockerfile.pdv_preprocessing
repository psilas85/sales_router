# ============================
# Dockerfile.pdv_preprocessing
# ============================

# Usa imagem base compartilhada
FROM psilas85/sales_router-base:latest

# Define o diret√≥rio de trabalho principal
WORKDIR /app

# Copia todo o diret√≥rio src (inclui database, pdv_preprocessing, etc.)
COPY ./src /app/src


# Copia depend√™ncias globais e instala (a maioria j√° na base)
COPY ./requirements.txt /app/requirements.txt
RUN pip install --no-cache-dir -r /app/requirements.txt

# Vari√°veis de ambiente padr√£o
ENV PYTHONPATH=/app/src \
    TZ=America/Sao_Paulo \
    ENV=production

# Exibe informa√ß√µes b√°sicas de debug
RUN python --version && pip list | grep -E "fastapi|pandas|psycopg2|rq|redis"

# üî• Comando padr√£o (executa a API FastAPI)
CMD ["uvicorn", "src.pdv_preprocessing.api.pdv_preprocessing_api:app", "--host", "0.0.0.0", "--port", "8000"]
